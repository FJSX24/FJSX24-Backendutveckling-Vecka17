ğŸš€ Lektion: Felhantering och validering i Express + MVC + Struktur

ğŸ’¡ LektionsmÃ¥l
Efter lektionen ska studenterna:

FÃ¶rstÃ¥ grunderna i felhantering i Node/Express.

Kunna anvÃ¤nda try/catch, next() och Express error-handling middleware.

Implementera datavalidering med biblioteket Joi.

FÃ¶rstÃ¥ MVC-strukturen(Youtube video om MVC) och mappstruktur i Express-applikationer. 

Kunna resonera kring skillnaden mellan MVC och headless.

Reflektera kring hur olika delar av backendutveckling hÃ¤nger ihop.

------------------------------------------------------------
ğŸ“ Lektionsplanering (3 timmar)

âœ… PowerPoint: Felhantering, Joi, Middleware, MVC, Struktur, Headless
âœ… Code-Along - Joi & errorHandler (kommenterad kod)
âœ… Visa MVC-struktur + walkthrough av mappstruktur
ğŸ§  Diskussion: Hur hÃ¤nger allt ihop?
âœ… SjÃ¤lvstÃ¤ndig Ã¶vning + Q&A

------------------------------------------------------------
------------------------------------------------------------
------------------------------------------------------------

ğŸ“Š PowerPoint Slides & Talarmanus

Slide 1: FelsÃ¶kning
ğŸ—£ï¸ Talarmanus:
"Vi bÃ¶rjar med felsÃ¶kning. Det fÃ¶rsta steget nÃ¤r nÃ¥got inte fungerar Ã¤r att isolera problemet. AnvÃ¤nder ni Postman eller Insomnia? Om inte, gÃ¶r det. Skapa en middleware som loggar varje request â€“ det Ã¤r guld vÃ¤rt nÃ¤r ni jagar buggar. LÃ¤gg console.log() i routes, se om det triggas. AnvÃ¤nd try/catch fÃ¶r att fÃ¶rhindra att servern kraschar vid fel."

-------------------------------------------------
Slide 2: Validering
ğŸ—£ï¸ Talarmanus:
"Validering innebÃ¤r att vi kontrollerar den inkommande datan â€“ stÃ¤mmer format, finns alla fÃ¤lt med? Utan validering kan anvÃ¤ndare eller buggar fÃ¶rstÃ¶ra vÃ¥ra datamodeller eller orsaka ovÃ¤ntade fel. Validering skyddar bÃ¥de vÃ¥r server och anvÃ¤ndarens upplevelse."

-------------------------------------------------
Slide 3: Autentisering
ğŸ—£ï¸ Talarmanus:
"Autentisering Ã¤r en typ av validering â€“ men pÃ¥ anvÃ¤ndarnivÃ¥. Vi kontrollerar om anvÃ¤ndaren Ã¤r den hen utger sig fÃ¶r att vara. Det gÃ¶rs vanligtvis via JWT eller sessions, men innan det sker mÃ¥ste vi validera anvÃ¤ndarens inloggningsdata."

-------------------------------------------------
Slide 4: Joi
ğŸ—£ï¸ Talarmanus:
"Joi Ã¤r ett bibliotek som hjÃ¤lper oss med validering i Node.js. Vi definierar ett schema som anger regler fÃ¶r hur datan ska se ut, och sedan validerar vi inkommande data mot det. Om nÃ¥got Ã¤r fel fÃ¥r vi ett tydligt felobjekt. Vi anvÃ¤nder Joi i routes innan vi skapar eller uppdaterar data."

-------------------------------------------------
ğŸ“Š PowerPoint Slides & Talarmanus (komplettering)

Slide 5: Middleware - repetition
ğŸ—£ï¸ "Middleware fungerar som ett filter fÃ¶r inkommande requests. Vi kan anvÃ¤nda dem fÃ¶r logging, validering, autentisering eller felhantering. De kÃ¶rs i ordning. AnvÃ¤nd app.use() fÃ¶r att koppla pÃ¥ middleware."

-------------------------------------------------
Slide 6: MVC â€“ Model View Controller
ğŸ—£ï¸ "MVC stÃ¥r fÃ¶r Model-View-Controller, en designprincip som hjÃ¤lper oss att separera ansvar i vÃ¥r applikation. I backendkontext med Express jobbar vi oftast med en modifierad version:

Model â€“ Hanterar datalagring, t.ex. en databasmodell (ex. Mongoose eller en mock).

Controller â€“ InnehÃ¥ller sjÃ¤lva logiken, alltsÃ¥ det som hÃ¤nder nÃ¤r en request tas emot.

Routes â€“ Tar emot requests frÃ¥n klienten och dirigerar dem till rÃ¤tt controller.

Denna separation gÃ¶r det lÃ¤ttare att:
HÃ¥lla koden testbar
Ã…teranvÃ¤nda logik
Arbeta i team parallellt utan att krocka

-------------------------------------------------
Slide 7: Struktur i backendprojekt
ğŸ—£ï¸ "En typisk struktur i Express kan se ut sÃ¥ hÃ¤r:
â”œâ”€â”€ controllers/
â”œâ”€â”€ models/
â”œâ”€â”€ routes/
â”œâ”€â”€ middlewares/
â”œâ”€â”€ validators/
â”œâ”€â”€ index.js

Vi undviker att lÃ¤gga all logik i routes â€“ vi bryter ut till controllers och validerar med middleware."

-------------------------------------------------
Slide 8: MVC vs Headless
ğŸ—£ï¸ "MVC bygger ofta hela appen, inklusive HTML-rendering, t.ex. med EJS eller Pug. I ett headless-upplÃ¤gg bygger vi bara API:et â€“ klienten hÃ¤mtar data och ansvarar fÃ¶r grÃ¤nssnittet (SPA, mobilapp osv). Headless gÃ¶r det enkelt att Ã¥teranvÃ¤nda samma backend till flera typer av klienter.(webb, mobil, etc).

-------------------------------------------------
OBS SE VIDEO OM MVC INNAN DENNA:

Slide 9: Hur allt hÃ¤nger ihop
ğŸ—£ï¸ "Vi har lÃ¤rt oss fÃ¶ljande komponenter i backend:

Node.js â€“ SjÃ¤lva plattformen vi kÃ¶r vÃ¥r kod i

Express â€“ VÃ¥rt ramverk som fÃ¶renklar HTTP-server och routing

Middleware â€“ Funktioner som exekveras innan din route-logik kÃ¶rs

Routing â€“ HÃ¤r bestÃ¤ms vilken controller som ska svara pÃ¥ vilken endpoint

API â€“ VÃ¥r definierade uppsÃ¤ttning endpoints

Validering â€“ SÃ¤kerstÃ¤ller att inkommande data Ã¤r korrekt

Felhantering â€“ Samlar fel pÃ¥ ett strukturerat sÃ¤tt, visar tydliga felmeddelanden

MVC â€“ VÃ¥r kodstruktur som gÃ¶r det hela lÃ¤sbart, testbart och skalbart

-------------------------------------------------
-------------------------------------------------
-------------------------------------------------
ğŸ’» Code-Along â€“ Joi & Felhantering

ğŸ—£ï¸ Code-Along Start:
"Hej alla! Nu ska vi fÃ¶rst validera inkommande data med Joi, och dÃ¤refter skapa en global error handler fÃ¶r att fÃ¥nga och hantera fel pÃ¥ ett strukturerat sÃ¤tt."

-------------------------------------------------
ğŸ—ï¸ Projektstruktur:

â”œâ”€â”€ index.js
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ users.js
â”œâ”€â”€ middlewares/
â”‚   â””â”€â”€ errorHandler.js
â”œâ”€â”€ validators/
â”‚   â””â”€â”€ userSchema.js
â”œâ”€â”€ package.json

-------------------------------------------------
ğŸ”§ 1. Installera nÃ¶dvÃ¤ndiga paket

npm init -y
npm install express joi

-------------------------------------------------
-------------------------------------------------
-------------------------------------------------
ğŸ“ Skapa huvudfilen: index.js

GenomfÃ¶r den koden.

-------------------------------------------------
ğŸ“ Skapa routes/users.js

GenomfÃ¶r den koden.

-------------------------------------------------
ğŸ“ 4. Skapa validators/userSchema.js

GenomfÃ¶r den koden.

-------------------------------------------------
ğŸ“ 5. Skapa middlewares/errorHandler.js

GenomfÃ¶r den koden.

-------------------------------------------------

ğŸ” Testa API:t live i Postman

Starta servern:
node index.js

-------------------------------------------------
Skicka ett korrekt anrop:

POST till http://localhost:3000/users

Body (JSON):
{
  "name": "Mandus",
  "email": "mandus@folkan.se",
  "age": 80
}

âœ… Ska returnera: 201 Created

-------------------------------------------------
Skicka ett felaktigt anrop (utan e-post):

{
  "name": "Mandus",
  "age": 35
}

âŒ Returnerar 400 + felmeddelande om att e-post saknas

-------------------------------------------------
-------------------------------------------------
-------------------------------------------------
ğŸ§  ReflektionsfrÃ¥gor till diskussion

Vad Ã¤r skillnaden mellan routing och controller?

VarfÃ¶r Ã¤r middleware sÃ¥ viktigt i Express?

Vad vinner vi pÃ¥ att anvÃ¤nda MVC?

Hur pÃ¥verkar filstruktur mÃ¶jligheten att vÃ¤xa som team?

Var skulle du lÃ¤gga logiken fÃ¶r att skapa en anvÃ¤ndare?

-------------------------------------------------
-------------------------------------------------
-------------------------------------------------
ğŸ—£ï¸ Sammanfattning
"Vi har idag lÃ¤rt oss inte bara tekniker som Joi och error middleware, utan ocksÃ¥ strukturer som gÃ¶r vÃ¥rt API hÃ¥llbart och skalbart. Ni har nu byggstenarna fÃ¶r att skapa professionella backendlÃ¶sningar â€“ med struktur, sÃ¤kerhet och fÃ¶rstÃ¥else fÃ¶r helheten. Grymt jobbat!"

-------------------------------------------------
-------------------------------------------------
-------------------------------------------------
ğŸ—£ï¸ SjÃ¤lvstÃ¤ndig Ã–vningar:
